name: Prepare docker image
inputs:
  namui-cli-changed:
    required: true
runs:
  using: composite
  steps:
    - shell: bash
      run: echo ${{ inputs.namui-cli-changed }}

    - name: Build image
      if: inputs.namui-cli-changed == 'true'
      shell: bash
      run: docker build . -f docker-images/namui-test-host/linux.Dockerfile
        -t $IMAGE_NAME --cache-from $IMAGE_NAME --label "runnumber=${GITHUB_RUN_ID}"

    - name: Save image
      shell: bash
      run: docker save $IMAGE_NAME -o /tmp/namui-test-host-image.tar

    - name: Upload image to artifact
      uses: actions/upload-artifact@v2
      with:
        name: namui-test-host-image
        path: /tmp/namui-test-host-image.tar
