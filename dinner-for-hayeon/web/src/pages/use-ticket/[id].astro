---
import { getSession } from "auth-astro/server";
import "../../styles/global.css";
import UseTicket from "../../components/use-ticket/UseTicket.tsx";

export const prerender = false;

const { id } = Astro.params;
const session = await getSession(Astro.request);

// 로그인 체크
if (!session) {
  return Astro.redirect("/");
}

const mockFundings = [
  {
    id: "1",
    title: "하연이의 파스타 데이트 펀딩",
    thumbnail:
      "https://images.unsplash.com/photo-1621996346565-e3dbc353d2e5?w=400&h=300&fit=crop",
    currentTickets: 15,
    targetTickets: 30,
  },
  {
    id: "2",
    title: "로맨틱 프렌치 코스 저녁식사",
    thumbnail:
      "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400&h=300&fit=crop",
    currentTickets: 8,
    targetTickets: 20,
  },
  {
    id: "3",
    title: "특별한 날 스테이크 하우스",
    thumbnail:
      "https://images.unsplash.com/photo-1546833999-b9f581a1996d?w=400&h=300&fit=crop",
    currentTickets: 22,
    targetTickets: 25,
  },
  {
    id: "4",
    title: "일본 정통 가이세키 요리",
    thumbnail:
      "https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=400&h=300&fit=crop",
    currentTickets: 3,
    targetTickets: 15,
  },
  {
    id: "5",
    title: "홈메이드 한식 풀코스",
    thumbnail:
      "https://images.unsplash.com/photo-1498654896293-37aacf113fd9?w=400&h=300&fit=crop",
    currentTickets: 12,
    targetTickets: 18,
  },
  {
    id: "6",
    title: "미슐랭 스타 레스토랑 체험",
    thumbnail:
      "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
    currentTickets: 5,
    targetTickets: 50,
  },
];

const funding = mockFundings.find((f) => f.id === id);

if (!funding) {
  return Astro.redirect("/404");
}

// 가짜 사용자 티켓 데이터 (실제로는 DB에서 가져올 것)
const userTickets = 0; // 사용자가 가진 티켓 개수
---

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>티켓 사용하기 - {funding.title}</title>
  </head>
  <body>
    <UseTicket
      session={session}
      funding={funding}
      userTickets={userTickets}
      client:load
    />
  </body>
</html>
